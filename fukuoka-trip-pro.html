<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¦å²¡æ—…éŠ 2026 - é›²ç«¯åŒæ­¥ç‰ˆ</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/826/826070.png">

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ğŸ”‘ è«‹åœ¨æ­¤å¡«å…¥æ‚¨å¾ Firebase Console è¤‡è£½çš„ Config
        const firebaseConfig = {
  apiKey: "AIzaSyDMB5dU2aRAZ-mt9_HNXP02_9_B2qydfBg",
  authDomain: "fukuoka-trip-c2570.firebaseapp.com",
  databaseURL: "https://fukuoka-trip-c2570-default-rtdb.firebaseio.com",
  projectId: "fukuoka-trip-c2570",
  storageBucket: "fukuoka-trip-c2570.firebasestorage.app",
  messagingSenderId: "887170926378",
  appId: "1:887170926378:web:3e7c72bb374775c29e8053",
  measurementId: "G-HYDZ7L3T0Y"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // æ›è¼‰åˆ°å…¨åŸŸè®“ Vue å­˜å–
        window.fbDB = db; window.fbRef = ref; window.fbOnValue = onValue; window.fbSet = set; window.fbUpdate = update;

        // åˆå§‹åŒ–ä¸Šå‚³å‡½å¼ (åƒ…éœ€åŸ·è¡Œä¸€æ¬¡)
        window.uploadToCloud = async () => {
            const initData = {
                hotel: { name: "Best Western Plus ç¦å²¡å¤©ç¥å—", phone: "+81 927187700" },
                itinerary: [
                    { date: "03-03", week: "é€±äºŒ", coords: [{lat: 33.5859, lng: 130.4439}], events: [{time: "15:25", location: "æŠµé”ç¦å²¡ç©ºæ¸¯", desc: "è™èˆª IT270"}, {time: "æ™šä¸Š", location: "éºµå±‹å…¼è™ å¤©ç¥æœ¬åº—", desc: "çŸ¥åæ²¾éºµ"}]},
                    { date: "03-04", week: "é€±ä¸‰", coords: [{lat: 33.5932, lng: 130.4105}], events: [{time: "æ—©ä¸Š", location: "é‹æ²³åŸ & æ«›ç”°ç¥ç¤¾", desc: "å¸‚å€åƒæ‹œ"}, {time: "æ™šä¸Š", location: "è—¥é™¢ç‡’è‚‰", desc: "æ™šé¤é ç´„"}]},
                    { date: "03-05", week: "é€±å››", coords: [{lat: 32.7150, lng: 131.3015}], events: [{time: "å…¨å¤©", location: "é«˜åƒç©—/é˜¿è˜‡å±±ä¸€æ—¥éŠ", desc: "ä¹å·è‡ªç„¶æ™¯è§€"}]},
                    { date: "03-06", week: "é€±äº”", coords: [{lat: 33.5215, lng: 130.5348}], events: [{time: "å…¨å¤©", location: "å¤ªå®°åºœ", desc: "å¤©æ»¿å®®åƒæ‹œ"}]},
                    { date: "03-07", week: "é€±å…­", coords: [{lat: 33.3444, lng: 131.3283}], events: [{time: "å…¨å¤©", location: "ç”±å¸ƒé™¢/è‡ªç„¶å‹•ç‰©åœ’", desc: "KKday å°ˆå±¬åœ˜"}]},
                    { date: "03-08", week: "é€±æ—¥", coords: [{lat: 33.9448, lng: 130.9634}], events: [{time: "å…¨å¤©", location: "é–€å¸æ¸¯", desc: "ç‡’å’–å“©èˆ‡å¤è¹Ÿ"}]},
                    { date: "03-09", week: "é€±ä¸€", coords: [{lat: 33.6366, lng: 130.1982}], events: [{time: "å…¨å¤©", location: "ç³¸å³¶ä¸€æ—¥éŠ", desc: "æµ·é‚Šé¦éŸ†"}]},
                    { date: "03-10", week: "é€±äºŒ", coords: [{lat: 33.6133, lng: 130.3015}], events: [{time: "å…¨å¤©", location: "èƒ½å¤å³¶", desc: "æ¸¡èˆ¹è³èŠ±"}]},
                    { date: "03-11", week: "é€±ä¸‰", coords: [{lat: 33.5859, lng: 130.4354}], events: [{time: "å…¨å¤©", location: "LaLaport ç¦å²¡", desc: "çœ‹ 1:1 é‹¼å½ˆ"}]},
                    { date: "03-12", week: "é€±å››", coords: [{lat: 33.5912, lng: 130.3989}], events: [{time: "å…¨å¤©", location: "å¤©ç¥æœ€å¾Œæ¡è²·", desc: "è³¼ç‰©è¡åˆº"}]},
                    { date: "03-13", week: "é€±äº”", coords: [{lat: 33.5859, lng: 130.4439}], events: [{time: "19:55", location: "ç¦å²¡ç©ºæ¸¯", desc: "è™èˆª IT271"}]}
                ],
                sharedFX: { jpy: 0, twd: 0 }
            };
            await set(ref(db, '/'), initData);
            alert("é›²ç«¯è³‡æ–™åˆå§‹åŒ–æˆåŠŸï¼");
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { background-color: #fcfcfc; font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .date-active { background: #1a1a1a; color: white !important; transform: translateY(-4px); }
        #google-map { height: 60vh; width: 100%; border-radius: 24px; }
        .edit-input { background: transparent; border: none; width: 100%; font-weight: bold; border-bottom: 1px dashed #eee; transition: 0.3s; }
        .edit-input:focus { outline: none; border-bottom-color: #000; background: #f9f9f9; }
        .tab-bar { box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col pb-24 bg-white relative">
        
        <header class="sticky top-0 z-[1000] bg-white/90 backdrop-blur-md pt-6 pb-2 px-5 border-b">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold tracking-tight">ç¦å²¡ 2026</h1>
                <button @click="forceSync" class="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full font-bold">
                    <i class="fas fa-cloud-upload-alt mr-1"></i> åˆå§‹åŒ–é›²ç«¯
                </button>
            </div>
            <div class="flex overflow-x-auto hide-scrollbar gap-3 py-2">
                <div v-for="(day, index) in itinerary" :key="index" @click="changeDay(index)"
                     :class="['flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center cursor-pointer transition-all', 
                              activeDayIndex === index ? 'date-active shadow-lg' : 'bg-gray-50 text-gray-400']">
                    <span class="text-[8px] font-bold">{{day.week}}</span>
                    <span class="text-base font-bold">{{day.date.split('-')[1]}}</span>
                </div>
            </div>
        </header>

        <main class="flex-grow">
            <div v-show="activeTab === 'trip'" class="p-6">
                <div class="mb-6 p-4 bg-gray-50 rounded-2xl">
                    <span class="text-[10px] text-gray-400 font-bold uppercase block mb-1">ä½å®¿é£¯åº—</span>
                    <input v-model="hotel.name" @change="updateHotel" class="edit-input text-lg">
                    <input v-model="hotel.phone" @change="updateHotel" class="edit-input text-xs text-gray-500 font-mono mt-1">
                </div>

                <div class="space-y-10 relative before:absolute before:left-[11px] before:top-2 before:bottom-2 before:w-[1px] before:bg-gray-100">
                    <div v-for="(event, eIndex) in itinerary[activeDayIndex]?.events" :key="eIndex" class="relative pl-10">
                        <div class="absolute left-0 top-1.5 w-6 h-6 bg-white border-2 border-black rounded-full flex items-center justify-center z-10 shadow-sm">
                            <div class="w-1.5 h-1.5 bg-black rounded-full"></div>
                        </div>
                        <div class="group">
                            <input v-model="event.time" @change="updateItinerary" class="text-[10px] font-mono text-gray-400 w-full focus:outline-none mb-1">
                            <input v-model="event.location" @change="updateItinerary" class="edit-input text-base text-gray-900 mb-1">
                            <textarea v-model="event.desc" @change="updateItinerary" class="text-xs text-gray-400 w-full bg-transparent focus:outline-none resize-none" rows="1"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div v-show="activeTab === 'map'" class="p-4 h-full">
                <div id="google-map" class="shadow-2xl border"></div>
                <button @click="centerOnUser" class="mt-4 w-full py-4 bg-black text-white rounded-2xl font-bold shadow-lg flex items-center justify-center">
                    <i class="fas fa-location-arrow mr-2"></i> é¡¯ç¤ºæˆ‘çš„ä½ç½®
                </button>
            </div>

            <div v-show="activeTab === 'fx'" class="p-10 text-center">
                <h2 class="text-2xl font-bold mb-10 tracking-tight">å¤šäººåŒæ­¥æ›ç®—</h2>
                <div class="space-y-12">
                    <div class="relative">
                        <label class="text-[10px] font-bold text-gray-400 uppercase absolute -top-6 left-0">æ—¥å¹£ JPY</label>
                        <input type="number" v-model="jpy" @input="convertFX('jpy')" class="text-5xl font-mono w-full text-right border-b-2 border-gray-100 focus:outline-none focus:border-black py-2" placeholder="0">
                    </div>
                    <div class="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center mx-auto text-gray-300">
                        <i class="fas fa-exchange-alt rotate-90"></i>
                    </div>
                    <div class="relative">
                        <label class="text-[10px] font-bold text-gray-400 uppercase absolute -top-6 left-0">å°å¹£ TWD</label>
                        <input type="number" v-model="twd" @input="convertFX('twd')" class="text-5xl font-mono w-full text-right border-b-2 border-gray-100 focus:outline-none focus:border-black py-2" placeholder="0">
                    </div>
                </div>
                <p class="mt-12 text-[10px] text-gray-300">åŒ¯ç‡é è¨­ï¼š0.21 | æ‰€æœ‰äººå¯è¦‹å³æ™‚çµæœ</p>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 h-20 bg-white border-t flex justify-around items-center px-4 tab-bar z-[2000]">
            <button @click="activeTab = 'trip'" :class="activeTab === 'trip' ? 'text-black' : 'text-gray-300'" class="flex flex-col items-center w-1/3">
                <i class="fas fa-calendar-alt text-xl"></i><span class="text-[9px] mt-1 font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="activeTab = 'map'" :class="activeTab === 'map' ? 'text-black' : 'text-gray-300'" class="flex flex-col items-center w-1/3">
                <i class="fas fa-map-marked-alt text-xl"></i><span class="text-[9px] mt-1 font-bold">åœ°åœ–</span>
            </button>
            <button @click="activeTab = 'fx'" :class="activeTab === 'fx' ? 'text-black' : 'text-gray-300'" class="flex flex-col items-center w-1/3">
                <i class="fas fa-coins text-xl"></i><span class="text-[9px] mt-1 font-bold">åŒ¯ç‡</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        createApp({
            setup() {
                const activeTab = ref('trip');
                const activeDayIndex = ref(0);
                const jpy = ref(null);
                const twd = ref(null);
                const rate = 0.21;
                const hotel = ref({ name: 'è®€å–ä¸­...', phone: '' });
                const itinerary = ref([]);
                let map, userMarker, markers = [];

                // æ ¸å¿ƒåŒæ­¥é‚è¼¯
                const initFirebase = () => {
                    const db = window.fbDB;
                    if (!db) return setTimeout(initFirebase, 500);

                    window.fbOnValue(window.fbRef(db, '/'), (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            itinerary.value = data.itinerary || [];
                            hotel.value = data.hotel || { name: '', phone: '' };
                            if (data.sharedFX) {
                                jpy.value = data.sharedFX.jpy;
                                twd.value = data.sharedFX.twd;
                            }
                            if (activeTab.value === 'map') updateMarkers();
                        }
                    });
                };

                const updateHotel = () => { window.fbUpdate(window.fbRef(window.fbDB, 'hotel'), hotel.value); };
                const updateItinerary = () => { window.fbUpdate(window.fbRef(window.fbDB, '/'), { itinerary: itinerary.value }); };
                const forceSync = () => { window.uploadToCloud(); };

                const convertFX = (type) => {
                    let j, t;
                    if (type === 'jpy') {
                        j = jpy.value; t = j ? Math.round(j * rate) : null;
                    } else {
                        t = twd.value; j = t ? Math.round(t / rate) : null;
                    }
                    window.fbUpdate(window.fbRef(window.fbDB, 'sharedFX'), { jpy: j, twd: t });
                };

                // åœ°åœ–åŠŸèƒ½
                const initMap = () => {
                    if (map) return updateMarkers();
                    map = new google.maps.Map(document.getElementById("google-map"), {
                        zoom: 14, center: { lat: 33.5902, lng: 130.4017 }, disableDefaultUI: true,
                        styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }]
                    });
                    trackUser();
                    updateMarkers();
                };

                const updateMarkers = () => {
                    markers.forEach(m => m.setMap(null));
                    markers = [];
                    const day = itinerary.value[activeDayIndex.value];
                    if (!day || !day.coords) return;
                    
                    const bounds = new google.maps.LatLngBounds();
                    day.coords.forEach(coord => {
                        const m = new google.maps.Marker({ position: coord, map: map, animation: google.maps.Animation.DROP });
                        markers.push(m);
                        bounds.extend(coord);
                    });
                    if (day.coords.length > 0) map.fitBounds(bounds, 80);
                };

                const trackUser = () => {
                    if (navigator.geolocation) {
                        navigator.geolocation.watchPosition(pos => {
                            const p = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                            if (!userMarker) userMarker = new google.maps.Marker({ position: p, map: map, icon: { path: google.maps.SymbolPath.CIRCLE, scale: 8, fillColor: '#4285F4', fillOpacity: 1, strokeColor: 'white', strokeWeight: 2 }});
                            else userMarker.setPosition(p);
                        });
                    }
                };

                const centerOnUser = () => { if (userMarker) map.panTo(userMarker.getPosition()); };
                const changeDay = (index) => { activeDayIndex.value = index; if (activeTab.value === 'map') updateMarkers(); };

                watch(activeTab, (t) => { if (t === 'map') setTimeout(initMap, 100); });
                onMounted(() => { setTimeout(initFirebase, 1000); });

                return { activeTab, activeDayIndex, itinerary, hotel, jpy, twd, changeDay, convertFX, centerOnUser, updateHotel, updateItinerary, forceSync };
            }
        }).mount('#app');
    </script>
</body>
</html>
