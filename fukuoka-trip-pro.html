<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¦å²¡æ—…éŠ 2026 - é›²ç«¯åŒæ­¥æ°£è±¡ç‰ˆ</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/826/826070.png">

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ğŸ”‘ è«‹å¡«å…¥æ‚¨çš„ Firebase é…ç½®
        const firebaseConfig = {
  apiKey: "AIzaSyDMB5dU2aRAZ-mt9_HNXP02_9_B2qydfBg",
  authDomain: "fukuoka-trip-c2570.firebaseapp.com",
  databaseURL: "https://fukuoka-trip-c2570-default-rtdb.firebaseio.com",
  projectId: "fukuoka-trip-c2570",
  storageBucket: "fukuoka-trip-c2570.firebasestorage.app",
  messagingSenderId: "887170926378",
  appId: "1:887170926378:web:3e7c72bb374775c29e8053",
  measurementId: "G-HYDZ7L3T0Y"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window.fb = { db, ref, onValue, update, set };

        // åˆå§‹åŒ– 3/3 - 3/13 è¡Œç¨‹
        window.resetCloudData = async () => {
            const data = {
                hotel: { name: "Best Western Plus ç¦å²¡å¤©ç¥å—", phone: "+81 927187700" },
                itinerary: [
                    { date: "03-03", week: "é€±äºŒ", events: [{time: "15:25", location: "ç¦å²¡ç©ºæ¸¯", desc: "æ­æ©Ÿ IT270"}, {time: "æ™šä¸Š", location: "éºµå±‹å…¼è™ å¤©ç¥æœ¬åº—", desc: "çŸ¥åæ²¾éºµ"}] },
                    { date: "03-04", week: "é€±ä¸‰", events: [{time: "æ—©ä¸Š", location: "é‹æ²³åŸ æ«›ç”°ç¥ç¤¾", desc: "å¸‚å€åƒæ‹œ"}, {time: "æ™šä¸Š", location: "è—¥é™¢ç‡’è‚‰", desc: "æ™šé¤"}] },
                    { date: "03-05", week: "é€±å››", events: [{time: "å…¨å¤©", location: "é«˜åƒç©—/é˜¿è˜‡å±±", desc: "ä¹å·ä¸€æ—¥éŠ"}] },
                    { date: "03-06", week: "é€±äº”", events: [{time: "å…¨å¤©", location: "å¤ªå®°åºœ", desc: "å¤©æ»¿å®®åƒæ‹œ"}] },
                    { date: "03-07", week: "é€±å…­", events: [{time: "å…¨å¤©", location: "ç”±å¸ƒé™¢/è‡ªç„¶å‹•ç‰©åœ’", desc: "KKday å°ˆå±¬åœ˜"}] },
                    { date: "03-08", week: "é€±æ—¥", events: [{time: "å…¨å¤©", location: "é–€å¸æ¸¯", desc: "ç‡’å’–å“©èˆ‡å¤è¹Ÿ"}] },
                    { date: "03-09", week: "é€±ä¸€", events: [{time: "å…¨å¤©", location: "ç³¸å³¶ä¸€æ—¥éŠ", desc: "æµ·é‚Šæ™¯è§€"}] },
                    { date: "03-10", week: "é€±äºŒ", events: [{time: "å…¨å¤©", location: "èƒ½å¤å³¶", desc: "æ¸¡èˆ¹è³èŠ±"}] },
                    { date: "03-11", week: "é€±ä¸‰", events: [{time: "å…¨å¤©", location: "LaLaport ç¦å²¡", desc: "1:1 é‹¼å½ˆ"}] },
                    { date: "03-12", week: "é€±å››", events: [{time: "å…¨å¤©", location: "é‹æ²³åŸ æ«›ç”°ç¥ç¤¾", desc: "æœ€å¾Œæ¡è²·"}] },
                    { date: "03-13", week: "é€±äº”", events: [{time: "æ™šä¸Š", location: "ç¦å²¡ç©ºæ¸¯", desc: "å›ç¨‹æ­æ©Ÿ IT271"}] }
                ],
                sharedFX: { jpy: 0, twd: 0 }
            };
            await set(ref(db, '/'), data);
            alert("é›²ç«¯è³‡æ–™å·²é‡è¨­æˆåŠŸï¼");
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { background-color: #fcfcfc; font-family: 'Noto Sans TC', sans-serif; }
        .date-active { background: #1a1a1a; color: white !important; transform: scale(1.05); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .fx-input { border: none; border-bottom: 2px solid #f0f0f0; background: transparent; transition: 0.3s; width: 100%; text-align: right; }
        .fx-input:focus { outline: none; border-bottom-color: #1a1a1a; }
    </style>
</head>
<body class="antialiased pb-24">
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white relative shadow-2xl">
        
        <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md pt-6 pb-2 px-5 border-b">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-black italic tracking-tighter">FUKUOKA 2026</h1>
                <button @click="forceReset" class="text-[9px] text-gray-300 hover:text-red-400">é›²ç«¯é‡æ–°æ•´ç†</button>
            </div>
            
            <div class="flex overflow-x-auto hide-scrollbar gap-3 py-2">
                <div v-for="(day, index) in itinerary" :key="index" @click="activeDayIndex = index"
                     :class="['flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center cursor-pointer transition-all', 
                              activeDayIndex === index ? 'date-active shadow-lg' : 'bg-gray-50 text-gray-400']">
                    <span class="text-[8px] font-bold">{{day.week}}</span>
                    <span class="text-base font-black">{{day.date.split('-')[1]}}</span>
                </div>
            </div>
        </header>

        <main>
            <div class="flex border-b text-[10px] font-bold uppercase tracking-widest text-gray-400">
                <button @click="activeTab = 'trip'" :class="activeTab === 'trip' ? 'text-black border-b-2 border-black' : ''" class="flex-1 py-4">æ¯æ—¥è¡Œç¨‹</button>
                <button @click="activeTab = 'fx'" :class="activeTab === 'fx' ? 'text-black border-b-2 border-black' : ''" class="flex-1 py-4">åŒ¯ç‡æ›ç®—</button>
            </div>

            <div v-show="activeTab === 'trip'" class="p-6">
                <div class="mb-8 bg-gradient-to-br from-sky-400 to-blue-600 rounded-3xl p-5 text-white shadow-xl flex justify-between items-center">
                    <div>
                        <div class="text-[10px] font-bold opacity-70 uppercase tracking-widest mb-1">ç¦å²¡å³æ™‚æ°£æº«</div>
                        <div class="text-4xl font-black">{{ currentTemp }}Â°C</div>
                    </div>
                    <div class="text-right">
                        <i class="fas fa-cloud-sun text-3xl opacity-40"></i>
                        <div class="text-xs mt-2 font-bold">{{ weatherDesc }}</div>
                    </div>
                </div>

                <div class="mb-10 p-4 bg-gray-50 rounded-2xl border flex justify-between items-center">
                    <div class="flex-grow">
                        <span class="text-[9px] text-gray-400 font-bold block mb-1">ä½å®¿é£¯åº—</span>
                        <input v-model="hotel.name" @change="syncData" class="bg-transparent border-none font-bold text-sm w-full focus:outline-none">
                    </div>
                    <button @click="openMaps(hotel.name)" class="w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-blue-500">
                        <i class="fas fa-directions"></i>
                    </button>
                </div>

                <div class="space-y-10 relative before:absolute before:left-[11px] before:top-2 before:bottom-2 before:w-[1px] before:bg-gray-100">
                    <div v-for="(event, eIndex) in itinerary[activeDayIndex]?.events" :key="eIndex" class="relative pl-10">
                        <div class="absolute left-0 top-1.5 w-6 h-6 bg-white border-2 border-black rounded-full flex items-center justify-center z-10 shadow-sm">
                            <div class="w-1.5 h-1.5 bg-black rounded-full"></div>
                        </div>
                        <div class="flex justify-between items-start group">
                            <div class="flex-grow">
                                <input v-model="event.time" @change="syncData" class="text-[10px] font-mono text-gray-400 w-full focus:outline-none mb-1 bg-transparent" placeholder="æ™‚é–“">
                                <input v-model="event.location" @change="syncData" class="font-bold text-gray-900 w-full focus:outline-none bg-transparent" placeholder="åœ°é»åç¨±">
                                <textarea v-model="event.desc" @change="syncData" class="text-xs text-gray-400 w-full bg-transparent focus:outline-none resize-none mt-1" rows="1" placeholder="å‚™è¨»å…§å®¹"></textarea>
                            </div>
                            <button @click="openMaps(event.location)" class="mt-4 text-gray-300 hover:text-blue-500 transition">
                                <i class="fas fa-map-marker-alt text-lg"></i>
                            </button>
                        </div>
                    </div>
                    <button @click="addEvent" class="ml-10 text-[10px] font-bold text-blue-500 border border-blue-100 px-3 py-1 rounded-full">+ æ–°å¢é …ç›®</button>
                </div>
            </div>

            <div v-show="activeTab === 'fx'" class="p-10 space-y-12">
                <div class="text-center mb-4">
                    <h2 class="text-2xl font-black">å¤šäººå³æ™‚æ›ç®—</h2>
                    <p class="text-[10px] text-gray-400 mt-2">è¼¸å…¥é‡‘é¡ï¼Œæœ‹å‹æ‰‹æ©ŸæœƒåŒæ­¥æ›´æ–°çµæœ</p>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase block mb-2 tracking-widest">æ—¥å¹£ JPY</label>
                    <input type="number" v-model="jpy" @input="convertFX('jpy')" class="fx-input text-5xl font-mono" placeholder="0">
                </div>
                <div class="flex justify-center text-gray-200">
                    <i class="fas fa-sync-alt rotate-90 text-2xl"></i>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase block mb-2 tracking-widest">å°å¹£ TWD (åŒ¯ç‡ 0.21)</label>
                    <input type="number" v-model="twd" @input="convertFX('twd')" class="fx-input text-5xl font-mono" placeholder="0">
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const activeTab = ref('trip');
                const activeDayIndex = ref(0);
                const jpy = ref(null);
                const twd = ref(null);
                const rate = 0.21;
                const hotel = ref({ name: '', phone: '' });
                const itinerary = ref([]);
                
                // å¤©æ°£ç›¸é—œ
                const currentTemp = ref('--');
                const weatherDesc = ref('è®€å–ä¸­...');

                // Firebase åˆå§‹åŒ–
                const initFirebase = () => {
                    if (!window.fb) return setTimeout(initFirebase, 500);
                    window.fb.onValue(window.fb.ref(window.fb.db, '/'), (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            itinerary.value = data.itinerary || [];
                            hotel.value = data.hotel || { name: '', phone: '' };
                            if (data.sharedFX) { jpy.value = data.sharedFX.jpy; twd.value = data.sharedFX.twd; }
                        }
                    });
                };

                // æŠ“å–ç¦å²¡å³æ™‚æ°£æº«
                const fetchWeather = async () => {
                    try {
                        // ä½¿ç”¨å…¬é–‹çš„ OpenWeather API (ç¯„ä¾‹ä½¿ç”¨ç¦å²¡å¸‚)
                        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Fukuoka&units=metric&lang=zh_tw&appid=cedae7f40c8e9c11a1307668eabe4580`);
                        const data = await res.json();
                        if (data.main) {
                            currentTemp.value = Math.round(data.main.temp);
                            weatherDesc.value = data.weather[0].description;
                        }
                    } catch (e) { weatherDesc.value = "æ°£å€™è³‡æ–™æš«ä¸é©ç”¨"; }
                };

                // åŒæ­¥è³‡æ–™è‡³é›²ç«¯
                const syncData = () => {
                    window.fb.update(window.fb.ref(window.fb.db, '/'), {
                        itinerary: JSON.parse(JSON.stringify(itinerary.value)),
                        hotel: hotel.value
                    });
                };

                const convertFX = (type) => {
                    let j, t;
                    if (type === 'jpy') { j = jpy.value; t = j ? Math.round(j * rate) : null; }
                    else { t = twd.value; j = t ? Math.round(t / rate) : null; }
                    window.fb.update(window.fb.ref(window.fb.db, 'sharedFX'), { jpy: j, twd: t });
                };

                const addEvent = () => {
                    if (!itinerary.value[activeDayIndex.value].events) itinerary.value[activeDayIndex.value].events = [];
                    itinerary.value[activeDayIndex.value].events.push({ time: "12:00", location: "æ–°æ™¯é»", desc: "ç·¨è¼¯å‚™è¨»" });
                    syncData();
                };

                const openMaps = (loc) => { if(loc) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`, '_blank'); };
                const forceReset = () => { window.resetCloudData(); };

                onMounted(() => { 
                    initFirebase(); 
                    fetchWeather();
                });

                return { activeTab, activeDayIndex, itinerary, hotel, jpy, twd, currentTemp, weatherDesc, convertFX, syncData, openMaps, forceReset, addEvent };
            }
        }).mount('#app');
    </script>
</body>
</html>
